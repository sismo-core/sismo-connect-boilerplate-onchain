//SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.17;

import "forge-std/Test.sol";
import {Airdrop} from "../src/Airdrop.sol";
import {BaseTest} from "./base/BaseTest.t.sol";


contract AirdropTest is BaseTest {
  Airdrop public airdrop;

  function setUp() public {
    airdrop = new Airdrop("My airdrop contract", "AIR");
  }

function test_claimWithSismo() public {
    // Replace with actual response data from your app
    bytes
      memory response = hex"0000000000000000000000000000000000000000000000000000000000000020f4977993e52606cfd67b7a1cde71706900000000000000000000000000000000b8e2054f8a912367e38a22ce773328ff000000000000000000000000000000007369736d6f2d636f6e6e6563742d76310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000938f169352008d35e065f153be53b3d3c07bcd900000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000005400000000000000000000000000000000000000000000000000000000000000a200000000000000000000000000000000000000000000000000000000000000f0000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001a068796472612d73322e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000004a000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001260986941151c286da81eda4de92d29b49e11a4dc69c84475f62d6aeea350a8e00000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c02429a60f074ba4e87d553fc31f289c4457620fb2de434ce2e228c4ef31a4109214936b06147cb20405827852c559933ad0b1b6699a44e2a8a246beecf5b1395b14268865fd2262306b5f1089d7c4cb83131fe853da53b1f5825f18bc3166068b254f8d924bc1abd91942b12a54822a3d0b0fc8605206af9145ca421b642dddaa19d37b65b7587ea8e19d68c6761505616f9808feefafc71039659205f2beb0810c74d0581058910fd7002303d75d40a4e7fbe40fcd5c8af44164e667594e067305d0d909e06927dfcf3379b9587245878fbd965fd92854e6ede86db4783bcb56161145ca430871a110a791a4aa344cd445b3b4858e614a7b11092c5e365d04880000000000000000000000000000000000000000000000000000000000000000115e3da4d610e886c1400fc410b73c16e6691a1b7ffa7f2b3bfb1956b322bc122ab71fb864979b71106135acfa84afc1d756cda74f8f258896f896b4864f025630423b4c502f1cd4179a425723bf1e15c843733af2ecdee9aef6a0451ef2db74000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000260986941151c286da81eda4de92d29b49e11a4dc69c84475f62d6aeea350a8e02c02b0c8903e5f139b466d5bc5ceda4a647c4c72486e6d61de22fc3805abdd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c068796472612d73322e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000004c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000001cde61966decb8600dfd0749bd371f12000000000000000000000000000000006c617465737400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c018920f9b32a9a6c92c063ed6c320887e9817a259bad394d32b98d5a7d8de5f3509be1ab282c1213555ad2ebd29b31bf5882f2830001413c4eb825a9b0caa8a9d2217074e8779637eb28dfb9569226eaf17e9ee57d2855ead1d18f492964a679b165e40dae891203d30553bf2844ae68e081139522f26e01378ce4b63352610442cb3c3a54bda6eeaa73c516a313933b58fd8b65f7bb5ab6b41ffb96e3f97f65e1cabad77480fb2a8a67556aaaccdc3e3c03399f47a072b34a60786c22bedfacb1eae7b4f790a75ef7e5afc2e017cec75132f344cb0afc74f1546630a9c784a8114997b8d6966c1dff3a8eef0043c4fcad6d3a647ce4d2b06d83ae6e4047cd62d0000000000000000000000000000000000000000000000000000000000000000115e3da4d610e886c1400fc410b73c16e6691a1b7ffa7f2b3bfb1956b322bc122ab71fb864979b71106135acfa84afc1d756cda74f8f258896f896b4864f025630423b4c502f1cd4179a425723bf1e15c843733af2ecdee9aef6a0451ef2db742ed5df6fafafba04ea3eff495fb1539ee3a472db5fc4c0ddefbc026188bb582b29397141311df07a81a9b47e43a9bf186517f7e8f9e0a0d7dbd0fb0c9a14087b187e9738955a3f66ae7a1d5ee45d59e30bbcad1451d498ab2028967fcdb24db4000000000000000000000000000000000000000000000000000000000000000f1cde61966decb8600dfd0749bd371f126c6174657374000000000000000000000000000000000000000000000000000000000000000000000000000000000000260986941151c286da81eda4de92d29b49e11a4dc69c84475f62d6aeea350a8e02c02b0c8903e5f139b466d5bc5ceda4a647c4c72486e6d61de22fc3805abdd000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c068796472612d73322e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000004c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000e9ed316946d3d98dfcd829a53ec9822e000000000000000000000000000000006c617465737400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c0142f8f1e09c05f73b83b0f2cf850d1ef3083e7d08d2e3dafcc55d6b71f31405a25a0cb8ade167cf7b29cf9abb2cfc9d063a9f4d49fc104333b4da3d4357373202c94456eee7da34bf183fc4a2c72f4f904f788a59d5f55337a4a4355f35b424006b8f098c8a900c7a3ef79092da74a805523378ad5a96687fa3b9920f24ee6c31d1a64dbec507a17ac989a88a96d2cc6e604aead7c47bed3c74b5c592649c0e10ddb6b94f36f2054309f23bcafaec7c28e12f056ae532429c6e2d7de045f96fd14b8e002cb82d2c9ba0d63833f0a8c8880ad70cb37223ae1751946a7f654da5811aa9510cf606ee8d983596343c288ad28c37659cc1f4c4021fa07bd9a6b3e7f0000000000000000000000000000000000000000000000000000000000000000115e3da4d610e886c1400fc410b73c16e6691a1b7ffa7f2b3bfb1956b322bc122ab71fb864979b71106135acfa84afc1d756cda74f8f258896f896b4864f025630423b4c502f1cd4179a425723bf1e15c843733af2ecdee9aef6a0451ef2db742ed5df6fafafba04ea3eff495fb1539ee3a472db5fc4c0ddefbc026188bb582b243fa46a2881f25f11de405ed8cc9b3eb27f4f663a818bbe19fd4c7da1894b0129aefcc62b3a4b262f173641e26af8862a307aa4f9c22b27bde56c5627806c550000000000000000000000000000000000000000000000000000000000000003285bf79dc20d58e71b9712cb38c420b9cb91d3438c8e3dbaf07829b03ffffffc0000000000000000000000000000000000000000000000000000000000000000260986941151c286da81eda4de92d29b49e11a4dc69c84475f62d6aeea350a8e02c02b0c8903e5f139b466d5bc5ceda4a647c4c72486e6d61de22fc3805abdd000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c068796472612d73322e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000004c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000abf3ea8c23ff96893ac5caf4d2fa7c1f000000000000000000000000000000006c617465737400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c003fccfcf828b1256021ab4fd99d67d006e39ffd8cf50ea5182ba995d0103d6f61c3808d33e1b633f6d4c7776856b1ee0557de7959b0f1a266e76766064bd0c7429c0275060c5cbcc7888bea5f6edb2769cc15aa7b8a17d0fc9e4a5836118570123a3287bcfa2d117cbed827dc84f1b229111689f31daf5265eaf0277fe72c2bd0a6bf677bc1df5b29b21b45db628899adc94075e9b49f163976d3daf21ed186f295cbedc11f0246f956cf59a45185b01a358d5252a2757c1a7d6c21ec32545dd1f0a3ef654678f69f60591ee6afb55fb2b6f6c492d348296a0f3dc4a5f8acfe91e99ac9430fbb13c9c44f5c624cc2d6e1526285b1a8b55ce8f91ea9c21f9f6290000000000000000000000000000000000000000000000000000000000000000115e3da4d610e886c1400fc410b73c16e6691a1b7ffa7f2b3bfb1956b322bc122ab71fb864979b71106135acfa84afc1d756cda74f8f258896f896b4864f025630423b4c502f1cd4179a425723bf1e15c843733af2ecdee9aef6a0451ef2db742ed5df6fafafba04ea3eff495fb1539ee3a472db5fc4c0ddefbc026188bb582b1fe8cfa391ca1c4e0726cda7dcfb8cc23e3c06a4d3c54b666f90a742f44fe8520767bfccee5ad20fd1f71377304ea2e272fa3c8fa3ba113af69076b2af5f2f6500000000000000000000000000000000000000000000000000000000000000011ac6ff33806ab60c11d4f9d14e767307f3c5bb8c0647ae4c345a1f442ffffffd0000000000000000000000000000000000000000000000000000000000000000260986941151c286da81eda4de92d29b49e11a4dc69c84475f62d6aeea350a8e02c02b0c8903e5f139b466d5bc5ceda4a647c4c72486e6d61de22fc3805abdd0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"; 

    // Call the airdrop contract with this address as the msg.sender to have a valid signature
    vm.startPrank(0x938f169352008d35e065F153be53b3D3C07Bcd90);
    airdrop.claimWithSismo(response);
    assertEq(airdrop.balanceOf(0x938f169352008d35e065F153be53b3D3C07Bcd90), 500 * 10 ** 18);

    // Test that if you call the contract a second time, it reverts
    // Since the user has already claimed the token
    vm.expectRevert(abi.encodeWithSignature("AlreadyClaimed()"));
    airdrop.claimWithSismo(response);
  }
}

