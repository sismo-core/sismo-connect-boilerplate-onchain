//SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.17;

import "forge-std/Test.sol";
import {Airdrop} from "../src/Airdrop.sol";
import {BaseTest} from "./base/BaseTest.t.sol";


contract AirdropTest is BaseTest {
  Airdrop public airdrop;

  function setUp() public {
    airdrop = new Airdrop("My airdrop contract", "AIR");
  }

function test_claimWithSismo() public {
    _registerTreeRoot(13742996672213950612045363977698064109673524131987349704461232818461464424778);

    // Replace with actual response data from your app
    bytes
      memory response = hex"0000000000000000000000000000000000000000000000000000000000000020f4977993e52606cfd67b7a1cde71706900000000000000000000000000000000b8e2054f8a912367e38a22ce773328ff000000000000000000000000000000007369736d6f2d636f6e6e6563742d76310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000200000000000000000000000007def1d6d28d6bda49e69fa89ad75d160becba3ae000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000005600000000000000000000000000000000000000000000000000000000000000a400000000000000000000000000000000000000000000000000000000000000f20000000000000000000000000000000000000000000000000000000000000140000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001a068796472612d73322e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000004a00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101b42aaebc220a0702a5ee7e7ccf1a58f85a7b0bfc7e9ebe6de3fc5ab562a23e00000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c004b96d110b298d02598fb9ae477aa17dd6d5d8e98b200e029b29a76ed74c8dfd135225b1a9048f43619071a40ef2ce51c2c766e28731dbb48c74f2ee10bed843076c90012d68c2e1a2077f221d7807519f738c7b33f8b59474c1f76a571ef7650d7e3c8ede169a0e3b383217abd63449651ef16e3a0429bc1d64c5059606b4ee1764f0d614198aaadb630571db206d07e3fbc2090dfee33e0794ce971597408818ce7dbf1f14048e02a1ab6167a61f5cb795fa0eee789f6882f332419eec789a26289d1d9980bfe2d6b8667f825d363167841dc531996f4f09026a94f0aa5b3f0458102c6acd1cd214ff04d7c10e31f8bdb7f5ba411c3e7d99e479ff19f98ba9000000000000000000000000000000000000000000000000000000000000000009f60d972df499264335faccfc437669a97ea2b6c97a1a7ddf3f0105eda34b1d2ab71fb864979b71106135acfa84afc1d756cda74f8f258896f896b4864f025630423b4c502f1cd4179a425723bf1e15c843733af2ecdee9aef6a0451ef2db7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001b42aaebc220a0702a5ee7e7ccf1a58f85a7b0bfc7e9ebe6de3fc5ab562a23e02c02b0c8903e5f139b466d5bc5ceda4a647c4c72486e6d61de22fc3805abdd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c068796472612d73322e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000004c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000001cde61966decb8600dfd0749bd371f12000000000000000000000000000000006c617465737400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c0096a7cfd6e862c5a673b9a22de49445857b050f877e05073689e1f336fec4004217f5a83ff3e610bbb193b200bf937013f156915b31991d913034901f89d3f95097ec3b2ef85d6b64926ddcb7c89492cbf6656f255534fd788b1ce51362ad4691c7b98eb42ba879b46f2c7a121f30d5987183a845a2036d7b0158229d5388bb71d7e97e0cfc21c8a0de5f5e3c15cc6d756b30f7015253bf0ba6bfc5ed431292f278109437ba0fcf20a66410fcc31674bba5ffa8bb03c39004828e6c14be016a81ca7223d0d7a5fb32b5a4555d869779de42b279cb6643e7ea9e17152d0e348a4266a1c8ef84ffc808db5b3cf407c3797a73b26596b07bfb1b51531dca730d17a000000000000000000000000000000000000000000000000000000000000000009f60d972df499264335faccfc437669a97ea2b6c97a1a7ddf3f0105eda34b1d2ab71fb864979b71106135acfa84afc1d756cda74f8f258896f896b4864f025630423b4c502f1cd4179a425723bf1e15c843733af2ecdee9aef6a0451ef2db741e6242addac2505e6240ed62cf2cfe47aa06550d00f14761b607247e98d1714a29397141311df07a81a9b47e43a9bf186517f7e8f9e0a0d7dbd0fb0c9a14087b1ba2707c08b5b2a6771169dd8a521a74efacfb2d891d9d0076e11a7eab0d771c000000000000000000000000000000000000000000000000000000000000000f1cde61966decb8600dfd0749bd371f126c617465737400000000000000000000000000000000000000000000000000000000000000000000000000000000000001b42aaebc220a0702a5ee7e7ccf1a58f85a7b0bfc7e9ebe6de3fc5ab562a23e02c02b0c8903e5f139b466d5bc5ceda4a647c4c72486e6d61de22fc3805abdd000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c068796472612d73322e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000004c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000d630aa769278cacde879c5c0fe5d203c000000000000000000000000000000006c617465737400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c0020b16aad2ffc5963ba1a12022f619cfce1cf0fd68ecbeb4dec54b64345e32560668e082f4e7d640b4bf6eaaf5783dfaff1fda51d7b0a570241e83f4d80583de27169573a0b86e5f964c4636bf4b6fa8296656416bc385d810dad88300198a3e047771af4c01c96926946257fb344ab194effc903fa8a5092c24460e5bdcde0b08e5bd073931ab43ef57533318675a1af1b0a2267df346c4bc95956903ede15d2e6a43256bfa8f4cec4a11da719cfbd8b4c4fca2d52d7c6a259bb332b3dde25e2c61a5af464b8482cd6dd3bd7c841e8ea2931db99947491426d61c30a92034ca21ce58f18676829487d26aa532829331c005bddd0ddd5fceb23e6b7614583ac3000000000000000000000000000000000000000000000000000000000000000009f60d972df499264335faccfc437669a97ea2b6c97a1a7ddf3f0105eda34b1d2ab71fb864979b71106135acfa84afc1d756cda74f8f258896f896b4864f025630423b4c502f1cd4179a425723bf1e15c843733af2ecdee9aef6a0451ef2db741e6242addac2505e6240ed62cf2cfe47aa06550d00f14761b607247e98d1714a15e8b78c4616c5fed846fbd81f52ed63b62a818a56f8cfbb82fb425e8310ee382da4fe443f5e1c5bc3d6fcc1a013fe6c1952e308d283ac1f2cd4fa74443373050000000000000000000000000000000000000000000000000000000000000003149f70ab0db24a270738aee6f857bec7cb91d3438c8e3dbaf07829b03ffffffc000000000000000000000000000000000000000000000000000000000000000001b42aaebc220a0702a5ee7e7ccf1a58f85a7b0bfc7e9ebe6de3fc5ab562a23e02c02b0c8903e5f139b466d5bc5ceda4a647c4c72486e6d61de22fc3805abdd000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c068796472612d73322e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000004c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000029a90aaa3cf9431020c040a6c674efd3000000000000000000000000000000006c617465737400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c003a249931c93f8d9146a176a62524bde7ab59a7656ea3085a46ee49b9ada3e2e2c44e9160e22d9531e0e3328659b63eff4a11d7f8e59ad56c308f5fca897b687189d71bbb3bf9a1eeb8768112128d81c452ba269ea0fcb1c7055eb674820a0c2150d4e83991bf6366bb0f7415ca5c6dce64cb1283361408984386284231307ca28396746767c0bcc912efcda9dbb66ba594e4012582b536bd9815dce323573b90023d47ca6c623aa10e7219e38ee016122cf6c4ad46d8059437d97b77ddd6fa50d7f25326862d459db2378472e40f0bc506d8980f026bb561db387f6a168e5fa1a78318ed33c3411631edf67f9391aa83fba2dcb5e0906be6dd14b72c0dd9d62000000000000000000000000000000000000000000000000000000000000000009f60d972df499264335faccfc437669a97ea2b6c97a1a7ddf3f0105eda34b1d2ab71fb864979b71106135acfa84afc1d756cda74f8f258896f896b4864f025630423b4c502f1cd4179a425723bf1e15c843733af2ecdee9aef6a0451ef2db741e6242addac2505e6240ed62cf2cfe47aa06550d00f14761b607247e98d1714a09ec0a9aa394a167964c8c282dc17e4494b37fad9b9ecf30fb5b5c561d627f79081fd41d71786dd758950a2531b81da283abb73f46cd267a937fdd6ab265216a000000000000000000000000000000000000000000000000000000000000000129a90aaa3cf9431020c040a6c674efd36c617465737400000000000000000000000000000000000000000000000000000000000000000000000000000000000001b42aaebc220a0702a5ee7e7ccf1a58f85a7b0bfc7e9ebe6de3fc5ab562a23e02c02b0c8903e5f139b466d5bc5ceda4a647c4c72486e6d61de22fc3805abdd000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c068796472612d73322e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000004c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000045418b1a35d370469c0338116fdc1001000000000000000000000000000000006c617465737400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c01afc6141e1fa961d16f8a6f574eaad3fc1aff52ab7a4ee3da6b517a162facd5a2dad15ae1a5427cce86ff66cb39e7c86fff2b1c4af5f33e108e8bbca018b30e2067cdb33c7be36e2ec7b0cce5b031f8c75ffae5a3a5d6498f74baeda57306c6b029fa9c759a097a41330f2c7d47ee9acfe5459353db0ec493c1316cf86322765277335ff485d295c829fbe1e9c4704f1d341b2967dab4dba5d5a66271ba76d5a039a635fb1c4036ec2af7decacde1469e576af3c025ab8fa9d7b2c1f08bb6d100a76ca881e43535c20ca7247ac862a45030487708449434e2480e750897e30460d344279bfe87c6b6304bb1ba22e12c8befa9d0e041ce83319c9656ab033179a000000000000000000000000000000000000000000000000000000000000000009f60d972df499264335faccfc437669a97ea2b6c97a1a7ddf3f0105eda34b1d2ab71fb864979b71106135acfa84afc1d756cda74f8f258896f896b4864f025630423b4c502f1cd4179a425723bf1e15c843733af2ecdee9aef6a0451ef2db741e6242addac2505e6240ed62cf2cfe47aa06550d00f14761b607247e98d1714a22e65dbeeb998740b691907b477599edb7050061172aa9538f580a8a3abbc35c1a61fcf8455b5f7eae3d8d7757a38dccf6550d1f646d526c9efdc868b389c9e5000000000000000000000000000000000000000000000000000000000000000114dd3ca754a1d01ce3b2f25aee5ab7a4442d8c1cf9ba8f6ebc1e0a6c0fffffff000000000000000000000000000000000000000000000000000000000000000001b42aaebc220a0702a5ee7e7ccf1a58f85a7b0bfc7e9ebe6de3fc5ab562a23e02c02b0c8903e5f139b466d5bc5ceda4a647c4c72486e6d61de22fc3805abdd0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"; 

    // Call the airdrop contract with this address as the msg.sender to have a valid signature
    vm.startPrank(0x7def1d6D28D6bDa49E69fa89aD75d160BEcBa3AE);
    airdrop.claimWithSismo(response);
    assertEq(airdrop.balanceOf(0x7def1d6D28D6bDa49E69fa89aD75d160BEcBa3AE), 600 * 10 ** 18);

    // Test that if you call the contract a second time, it reverts
    // Since the user has already claimed the token
    vm.expectRevert(abi.encodeWithSignature("AlreadyClaimed()"));
    airdrop.claimWithSismo(response);
  }
}

