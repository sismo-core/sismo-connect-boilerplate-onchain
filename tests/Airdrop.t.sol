//SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.17;

import "forge-std/Test.sol";
import {Airdrop} from "../src/Airdrop.sol";
import {BaseTest} from "./base/BaseTest.t.sol";


contract AirdropTest is BaseTest {
  Airdrop public airdrop;

  // the appId from the Sismo Connect App we want to use
  bytes16 public constant APP_ID = 0xf4977993e52606cfd67b7a1cde717069;
  bool isImpersonationMode = true; // <--- set to true to allow verifying proofs from impersonated accounts

  function setUp() public {
    airdrop = new Airdrop("My airdrop contract", "AIR", APP_ID, isImpersonationMode);
  }

function test_claimWithSismo() public {
    _registerTreeRoot(13742996672213950612045363977698064109673524131987349704461232818461464424778);

    // Replace with actual response data from your app
    bytes
      memory response = hex"0000000000000000000000000000000000000000000000000000000000000020f4977993e52606cfd67b7a1cde71706900000000000000000000000000000000b8e2054f8a912367e38a22ce773328ff000000000000000000000000000000007369736d6f2d636f6e6e6563742d76312e31000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000061060a65146b3265c62fc8f3ae977c9b27260ff000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000005600000000000000000000000000000000000000000000000000000000000000a400000000000000000000000000000000000000000000000000000000000000f20000000000000000000000000000000000000000000000000000000000000140000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001a068796472612d73332e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000004a0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011a640786b66c9cfbc6e4ba90cf2d1aa905bc9153687ccd30fe64f88cc868f49700000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c0134db1b21529e818ef876165db3cd4750efc0e124f8d735cfefe12aecf623fa4173f2c03a5203945e86cb46b1ec1e768210cef8c92c8cf242c01bee200baa28f08992218903f06c6eece2d6987ff1abe06b3ca1cf820795644381f6a3f2bc53107ee06f19045f1ba5267d1d103bb23c4b11348f2915ac6fbe09945eae8d49b9314ac5b4364de8f6fa8788c9d0f720e9cb5d2857576dd1208bfe98941c60cdf4d0153231968d01a16948dfec67a6549a91c01475ae48771c59a9ff15081b2b21d068d8d9ec4ab1c3e4cd88f9c2441bcb5be22545867a00d2d156b06be1327a04f10a287c7d468175ef91e6d9e86c8b4bce7a7cf02872950b4ce12ce1e149494750000000000000000000000000000000000000000000000000000000000000000214649c394fbf6e29bf4e81a343902ccc2f24ba2f2b04a2a3277ca2f7b5aa4091801b584700a740f9576cc7e83745895452edc518a9ce60b430e1272fc4eb93b057cf80de4f8dd3e4c56f948f40c28c3acbeca71ef9f825597bf8cc059f1238b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001a640786b66c9cfbc6e4ba90cf2d1aa905bc9153687ccd30fe64f88cc868f49702c02b0c8903e5f139b466d5bc5ceda4a647c4c72486e6d61de22fc3805abdd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c068796472612d73332e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000004c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000001cde61966decb8600dfd0749bd371f12000000000000000000000000000000006c617465737400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c00e278734de77da2b3f67189dc2242d12b27e20b307710e6218547a88fbc428b50f500f3df613c0ebe1904947181997baa7e27e51393b4ea45e3a55b736a135162d82aae73613c367a8800f04b0a296bcc008cbc8bfbb644d2ccfd02d9a1a31fd268580b9d5eae23d9e25f8349c465fd019f11ae576cea3511570630b39532a7223a41ac1c84379f905800a3b43cd81147ef8971750d14d191faf920b7129a49608bb5d6a37be4d3386e106ff0c36e79ba40a73653299a234bee684e1127239d40aa8ac6c730949d5960185bfba4ade69cfc4946d9c8e258728c03fbb1c7ae01b263f17d15c8b86c13d1d4472b04cec82ea8f54406fbe1ca30ced63ac41b6c3390000000000000000000000000000000000000000000000000000000000000000214649c394fbf6e29bf4e81a343902ccc2f24ba2f2b04a2a3277ca2f7b5aa4091801b584700a740f9576cc7e83745895452edc518a9ce60b430e1272fc4eb93b057cf80de4f8dd3e4c56f948f40c28c3acbeca71ef9f825597bf8cc059f1238b0f0dc79fb9b302138f2bf82e93a17083db5a72f316778e58a070fcc84117df4129397141311df07a81a9b47e43a9bf186517f7e8f9e0a0d7dbd0fb0c9a14087b070ea58e750f803fac14900e4f9955a50312bcc6432b408457b6454fe6f17d45000000000000000000000000000000000000000000000000000000000000000f1cde61966decb8600dfd0749bd371f126c61746573740000000000000000000000000000000000000000000000000000000000000000000000000000000000001a640786b66c9cfbc6e4ba90cf2d1aa905bc9153687ccd30fe64f88cc868f49702c02b0c8903e5f139b466d5bc5ceda4a647c4c72486e6d61de22fc3805abdd000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c068796472612d73332e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000004c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000d630aa769278cacde879c5c0fe5d203c000000000000000000000000000000006c617465737400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c0254c6d028e68bb0a743d5fe229662e28f786518449f37c7c0d34cbc9fc377a0a296ee4ce3b8a9389ce947413f272e0621aaf7702d3f4d76a937f3631bd6953c223a47ec0e09a4ed1842f76a5fe42c5ae8e00a291c722e2bc434889937d55baa2182ccecc7c93ac3b040c91c4042468d7d95633f7e8596f0337a5346f177f655f2c68cf87b8b60eebf30d66877c73d0af013c84f3befcb9c76167d4bbec93549f2dc605361ed6d0924e0024a1f98330f41565601b9aa47f282c3ed3b01f27aee60873051f59f5179432ec0cc50c5f2745fc2eafb9d84389729d0bb24d6a166f4012d15f2c96ebe480a99af7f13559d6e7eba5df770cde350dd2b8148bceedf1e70000000000000000000000000000000000000000000000000000000000000000214649c394fbf6e29bf4e81a343902ccc2f24ba2f2b04a2a3277ca2f7b5aa4091801b584700a740f9576cc7e83745895452edc518a9ce60b430e1272fc4eb93b057cf80de4f8dd3e4c56f948f40c28c3acbeca71ef9f825597bf8cc059f1238b0f0dc79fb9b302138f2bf82e93a17083db5a72f316778e58a070fcc84117df4115e8b78c4616c5fed846fbd81f52ed63b62a818a56f8cfbb82fb425e8310ee380fda1508ba7662f88f3adae1e4f406d99192befdd41a0ede0579e9fb1a78da640000000000000000000000000000000000000000000000000000000000000001149f70ab0db24a270738aee6f857bec7cb91d3438c8e3dbaf07829b03ffffffc00000000000000000000000000000000000000000000000000000000000000001a640786b66c9cfbc6e4ba90cf2d1aa905bc9153687ccd30fe64f88cc868f49702c02b0c8903e5f139b466d5bc5ceda4a647c4c72486e6d61de22fc3805abdd000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c068796472612d73332e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000004c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000029a90aaa3cf9431020c040a6c674efd3000000000000000000000000000000006c617465737400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c00afdcdd8fcc0ca123d1c60fb37a97bc79fcd1773654429c5f1889b172a6f43431906632988dd3d394b335537454f9ca747db925eaaa7fb5055332e7930dee2740eb3debcf7105adc8022007b2451afd539a43f482bce99516f25624231bcd3af21e199d20f31a1197fa38d5b953a647acdc22ac70cd1f1db3859ac648eb30a23089b349f091f55660e2edbcbf874a522138975177274712124a05cb5d784aa1027e744ad7fb89d49d9aa9163e883eeb2152b3cf232168e988aa849c636f8987a207545e52da6a14af380e1e480ef2e69520636933a75844505a4836a6e4d2d8320f5403a2189720630db123367140105f6fac52be696bf1ebd15023d824a17d60000000000000000000000000000000000000000000000000000000000000000214649c394fbf6e29bf4e81a343902ccc2f24ba2f2b04a2a3277ca2f7b5aa4091801b584700a740f9576cc7e83745895452edc518a9ce60b430e1272fc4eb93b057cf80de4f8dd3e4c56f948f40c28c3acbeca71ef9f825597bf8cc059f1238b0f0dc79fb9b302138f2bf82e93a17083db5a72f316778e58a070fcc84117df4109ec0a9aa394a167964c8c282dc17e4494b37fad9b9ecf30fb5b5c561d627f792993f8d2280fa4b82cab39c8ea0624c3ead917b6ad5f031874ee3c8ba704a773000000000000000000000000000000000000000000000000000000000000000129a90aaa3cf9431020c040a6c674efd36c61746573740000000000000000000000000000000000000000000000000000000000000000000000000000000000001a640786b66c9cfbc6e4ba90cf2d1aa905bc9153687ccd30fe64f88cc868f49702c02b0c8903e5f139b466d5bc5ceda4a647c4c72486e6d61de22fc3805abdd000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c068796472612d73332e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000004c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000045418b1a35d370469c0338116fdc1001000000000000000000000000000000006c617465737400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c00b860506ec823d44598b37df62a413eb03f40c1feea82e4b086a0bade41b52ac2ceed8081b868cb2f345ce7eee6c8f16155f4826c0c5e4888281d57cec792cff29228ae41d34f7602f32ee59f52abde3d6249345e577191fb7f0e3566526e0b40abc6faa48019092d1f6a96db394705ceb8af122bb90fe913d6d4e89675b093c2d78bbfda1676ae986daff92dbb3cd8fbc62b4465ad44ffaffd16b688a177fef1019729b9e8bdcaa788bdbb662c9664f6ce5df6cf9a5e9e250841f09c0f26bf814d6ace2069a1bfb27eb6269b26ed493cb496b5470aa9e718ff19cc450d2a0f0193b83ab3fbe7bfa94457b9a5c85bb3b0ce2ea36d731d1c6d9658010beed8f5c0000000000000000000000000000000000000000000000000000000000000000214649c394fbf6e29bf4e81a343902ccc2f24ba2f2b04a2a3277ca2f7b5aa4091801b584700a740f9576cc7e83745895452edc518a9ce60b430e1272fc4eb93b057cf80de4f8dd3e4c56f948f40c28c3acbeca71ef9f825597bf8cc059f1238b0f0dc79fb9b302138f2bf82e93a17083db5a72f316778e58a070fcc84117df4122e65dbeeb998740b691907b477599edb7050061172aa9538f580a8a3abbc35c28761e41e97b8160e9e40dd414c2d0bfd2069c98f02c1691adced8c3550de484000000000000000000000000000000000000000000000000000000000000000114dd3ca754a1d01ce3b2f25aee5ab7a4442d8c1cf9ba8f6ebc1e0a6c0fffffff00000000000000000000000000000000000000000000000000000000000000001a640786b66c9cfbc6e4ba90cf2d1aa905bc9153687ccd30fe64f88cc868f49702c02b0c8903e5f139b466d5bc5ceda4a647c4c72486e6d61de22fc3805abdd0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"; 
    
    // Call the airdrop contract with this address as the msg.sender to have a valid signature
    vm.startPrank(0x061060a65146b3265C62fC8f3AE977c9B27260fF);
    airdrop.claimWithSismo(response);
    assertEq(airdrop.balanceOf(0x061060a65146b3265C62fC8f3AE977c9B27260fF), 400 * 10 ** 18);

    // Test that if you call the contract a second time, it reverts
    // Since the user has already claimed the token
    vm.expectRevert(abi.encodeWithSignature("AlreadyClaimed()"));
    airdrop.claimWithSismo(response);
  }
}

