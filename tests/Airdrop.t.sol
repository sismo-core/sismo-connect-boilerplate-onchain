// SPDX-License-Identifier: MIT
pragma solidity ^0.8.17;

import "forge-std/Test.sol";
import {Airdrop} from "../src/Airdrop.sol";
import {BaseTest} from "./base/BaseTest.t.sol";

contract AirdropTest is BaseTest {
    Airdrop public airdrop;

    function setUp() public {
        airdrop = new Airdrop("My airdrop contract", "AIR");
    }

    function test_claimWithSismo() public {
        // register the tree root
        _registerTreeRoot(13545933286264344629997074918475624213472438405662049342199396220774452260614);
        bytes memory response = hex"0000000000000000000000000000000000000000000000000000000000000020f4977993e52606cfd67b7a1cde71706900000000000000000000000000000000b8e2054f8a912367e38a22ce773328ff000000000000000000000000000000007369736d6f2d636f6e6e6563742d76310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000200000000000000000000000007def1d6d28d6bda49e69fa89ad75d160becba3ae0000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000005200000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001a068796472612d73322e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000004a0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011b7cd01692e5418691eccf2cc4523f86c937c2033688ff175f536086834030a300000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c00f50923f85dd6e53ea2b4b43b479d265e786fad32a703a47b8d934b070fb6dce1bf7f71c8bb63530459afc8bbc22a96890462a9f9df80f333126ca7256514edb14c3c1e7242518fab6b572fa7966d725a4e7529820a519594cb189030aa67f9c24f6416fb5d3cec46ae9b853a7db05fc4bab705a2132a6e88e53090e25559f30000384b9d5e61d3184820ce37c4cd5c984f25fa4346574b633e44870ed2a935f095f9421b3f522e0343440b3bbc8bbf0dd69edb19b7f739a3b3736e36b8311f20d1927c839b9eb9ca2d9b8813fb9278fedaf5686bc796856bfd26eb48e5e80d020cedece0d6b13b4e14ff584668e869adefcbf07707b0140e93e4e719eb35887000000000000000000000000000000000000000000000000000000000000000009f60d972df499264335faccfc437669a97ea2b6c97a1a7ddf3f0105eda34b1d1801b584700a740f9576cc7e83745895452edc518a9ce60b430e1272fc4eb93b057cf80de4f8dd3e4c56f948f40c28c3acbeca71ef9f825597bf8cc059f1238b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001b7cd01692e5418691eccf2cc4523f86c937c2033688ff175f536086834030a302c02b0c8903e5f139b466d5bc5ceda4a647c4c72486e6d61de22fc3805abdd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c068796472612d73322e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000004c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000001cde61966decb8600dfd0749bd371f12000000000000000000000000000000006c617465737400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c001d32cd4f3a6a6a43acc53a8c19a92063233b06a411f75b502678ea995caa2431fd9f459be3ca68b2e72b3299a1e87bc31e57e360b9ad9c77fbd8b55040c846226690ac4aa4ec6822ede0bf57873da9903c88086958dd538565a4998471cd81d014fd1af6876f84f026b8f326eddadfc70574de72e4816f8a511dc7b0fa1a1d5031d48c22ff7a87b69245b0e29975db242ab5f4d144c7f2fdd39b0ac585b044913ea65eca95be5af89e7ee4fba861873d6fa571182943326c83bdceadcf23d2d107c63e9c15dcd41af6de43b1e61fefe136a929fb2c5d189ed3111102e449b3b13e76cd9ea1ab0f2c835e65470004f83f98c6672ef8d400d678c39383ca73c4e000000000000000000000000000000000000000000000000000000000000000009f60d972df499264335faccfc437669a97ea2b6c97a1a7ddf3f0105eda34b1d1801b584700a740f9576cc7e83745895452edc518a9ce60b430e1272fc4eb93b057cf80de4f8dd3e4c56f948f40c28c3acbeca71ef9f825597bf8cc059f1238b1df2b9fe9f4407e699e5eb08989565d5fd47b947e753cda360a9b05f7b576f0629397141311df07a81a9b47e43a9bf186517f7e8f9e0a0d7dbd0fb0c9a14087b0aa4c3dac06014e2796b95596c84712555c7f1fa3b075bd09bb17649b4a67aca000000000000000000000000000000000000000000000000000000000000000f1cde61966decb8600dfd0749bd371f126c61746573740000000000000000000000000000000000000000000000000000000000000000000000000000000000001b7cd01692e5418691eccf2cc4523f86c937c2033688ff175f536086834030a302c02b0c8903e5f139b466d5bc5ceda4a647c4c72486e6d61de22fc3805abdd000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c068796472612d73322e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000004c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000e9ed316946d3d98dfcd829a53ec9822e000000000000000000000000000000006c617465737400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c00c82cc7fe7c8636e572888f62df9233234dad87c5992c682a650382709b148bf1c6b72e3b79e0c384da448be22c9dafca8ec2868cf561b1523001e40f37d0b231986e4028b12517ce0e535b9997a24d7aea422e85541d03d0ed165f5ccf62f6f1101321225f9df43537f45e03781ed1c01b5c6e208f77e7c694888f77bfcb4b90edc230e11991607115eb7dd58a1c6ab9625504da6b65d519e41030d675236ee2c57c5a5b394f632386c77e072246578f9051459b5e17ea57b2fcde93ae01392019a6e351885366edfe2f7d9788d71d506e8dbe5b07545667c0b8d081ecabe8d18044b96e83ba55cef4cc7f19594f03ad0e25a48d915540fcef08a14967daba8000000000000000000000000000000000000000000000000000000000000000009f60d972df499264335faccfc437669a97ea2b6c97a1a7ddf3f0105eda34b1d1801b584700a740f9576cc7e83745895452edc518a9ce60b430e1272fc4eb93b057cf80de4f8dd3e4c56f948f40c28c3acbeca71ef9f825597bf8cc059f1238b1df2b9fe9f4407e699e5eb08989565d5fd47b947e753cda360a9b05f7b576f06243fa46a2881f25f11de405ed8cc9b3eb27f4f663a818bbe19fd4c7da1894b01081d0b80a088128f8db5cf521a06b68816f1a11f3a3d531803656e0b1fe8560f0000000000000000000000000000000000000000000000000000000000000001285bf79dc20d58e71b9712cb38c420b9cb91d3438c8e3dbaf07829b03ffffffc00000000000000000000000000000000000000000000000000000000000000001b7cd01692e5418691eccf2cc4523f86c937c2033688ff175f536086834030a302c02b0c8903e5f139b466d5bc5ceda4a647c4c72486e6d61de22fc3805abdd0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"; // Replace with actual response data from your app

        // Call the airdrop contract with this address as the msg.sender to have a valid signature
        vm.startPrank(0x7def1d6D28D6bDa49E69fa89aD75d160BEcBa3AE);
        airdrop.claimWithSismo(response);

        // Test that if you call the contract a second time, it reverts
        // Since the user has already claimed the token
        vm.expectRevert(abi.encodeWithSignature("AlreadyClaimed()"));
        airdrop.claimWithSismo(response);
    }

    // function test_claimWithSismo_no_contributor_claim() public {
    //     // In this test, we provide response data that doesn't contain a Sismo Contributor Claim
    //     bytes memory response = hex"your actual response data"; // Replace with actual response data from your app
    //     vm.startPrank(0x70997970C51812dc3A010C7d01b50e0d17dc79C8);
        
    //     // As there is no contributor claim, the user will only get tokens based on the other claims (if any)
    //     // Expected amount of tokens is (result.claims.length - 1) * 100
    //     // You will need to replace `expectedAmount` with the actual expected amount
    //     uint256 expectedAmount = 100; 
    //     airdrop.claimWithSismo(response);
    //     assertEq(airdrop.balanceOf(0x70997970C51812dc3A010C7d01b50e0d17dc79C8), expectedAmount);
    // }

    // function test_claimWithSismo_invalid_response() public {
    //     // In this test, we provide invalid response data
    //     bytes memory response = hex"0000"; 
    //     vm.startPrank(0x70997970C51812dc3A010C7d01b50e0d17dc79C8);

    //     // It should revert as the response data is not valid
    //     vm.expectRevert("ERC721: token already minted"); // Replace with actual error message
    //     airdrop.claimWithSismo(response);
    // }
}