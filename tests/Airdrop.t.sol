//SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.17;

import "forge-std/Test.sol";
import {Airdrop} from "../src/Airdrop.sol";
import {BaseTest} from "./base/BaseTest.t.sol";


contract AirdropTest is BaseTest {
  Airdrop public airdrop;

  // the appId from the Sismo Connect App we want to use
  bytes16 public constant APP_ID = 0xf4977993e52606cfd67b7a1cde717069;
  bool isImpersonationMode = true; // <--- set to true to allow verifying proofs from impersonated accounts

  function setUp() public {
    airdrop = new Airdrop("My airdrop contract", "AIR", APP_ID, isImpersonationMode);
  }

function test_claimWithSismo() public {
    // Replace with actual response data from your app
    bytes
      memory response = hex"0000000000000000000000000000000000000000000000000000000000000020f4977993e52606cfd67b7a1cde71706900000000000000000000000000000000b8e2054f8a912367e38a22ce773328ff000000000000000000000000000000007369736d6f2d636f6e6e6563742d76312e31000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000938f169352008d35e065f153be53b3d3c07bcd90000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000005600000000000000000000000000000000000000000000000000000000000000a400000000000000000000000000000000000000000000000000000000000000f20000000000000000000000000000000000000000000000000000000000000140000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001a068796472612d73332e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000004a0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011b31234f626f2f815a2085465332f192349dc35c3afdd798ef78654b9d5a21b500000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c02d05bb1a0bb8637dc139e532f2c912854ddf17e531149274e49ef7a726e1492d2c5762053d911667635dfb54be3f43a595a5490044558f0cf0f386cf55196d04197ecbd1c54887ee9740030ed0016f2ae25846617258f1aca68d2625590eff1d0f023a275bb928c9c3ce10b85fb93b1eed0179cc434c4177a489b482139e901109c470d68b19959e38eb259b146e95b9da13530e9b554383ccecb8e6dd35095b07028919289593fd3aaede9d54786e99a94f3c489bc43d529adfbf13f9324abf03ee215ebb11e85239703b2b44f33517fc19db8eb2c311aab8177fa4d06680020fbee3f58f88536612cc1b157844742f6365ece3a1040103f1164600a2db0bdf0000000000000000000000000000000000000000000000000000000000000000115e3da4d610e886c1400fc410b73c16e6691a1b7ffa7f2b3bfb1956b322bc121801b584700a740f9576cc7e83745895452edc518a9ce60b430e1272fc4eb93b057cf80de4f8dd3e4c56f948f40c28c3acbeca71ef9f825597bf8cc059f1238b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001b31234f626f2f815a2085465332f192349dc35c3afdd798ef78654b9d5a21b502c02b0c8903e5f139b466d5bc5ceda4a647c4c72486e6d61de22fc3805abdd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c068796472612d73332e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000004c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000001cde61966decb8600dfd0749bd371f12000000000000000000000000000000006c617465737400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c02ce8d72168d91ffc5409b704aca7825c5f1ddd273e085ff522d000ffe4f9089216114fa5c3728a61235eabe23927868a0e85323006fff80495e154a44e4addfa1a7abddc14cd7f050c8f1b10560983a7a2dd2fad64ba9e42b29b6997268fe53323b35a0a25d5467345dabf5e58aa0ed339b9a8aede886501ff932a7a7ca6d7c50a977aff501c8c3aea4ecec86d880bc126a1d5d57ddab369d3951b48a903a3142c09998df19620712a04afa303fc2125b0d3eb25d8d693b0f3d6da4b6f489aba2ff370b8289104ed0fd37233a60b96966edf284a185e0c44827a823fdd155f961742ffd796b00c908591e41b8792a939478fd5147c6abfcf8d26c2c6f95f196c0000000000000000000000000000000000000000000000000000000000000000115e3da4d610e886c1400fc410b73c16e6691a1b7ffa7f2b3bfb1956b322bc121801b584700a740f9576cc7e83745895452edc518a9ce60b430e1272fc4eb93b057cf80de4f8dd3e4c56f948f40c28c3acbeca71ef9f825597bf8cc059f1238b13f534c30cef0c08f68969a071be9d153080dfc99207aa879d0b8d680b593eab29397141311df07a81a9b47e43a9bf186517f7e8f9e0a0d7dbd0fb0c9a14087b070ea58e750f803fac14900e4f9955a50312bcc6432b408457b6454fe6f17d45000000000000000000000000000000000000000000000000000000000000000f1cde61966decb8600dfd0749bd371f126c61746573740000000000000000000000000000000000000000000000000000000000000000000000000000000000001b31234f626f2f815a2085465332f192349dc35c3afdd798ef78654b9d5a21b502c02b0c8903e5f139b466d5bc5ceda4a647c4c72486e6d61de22fc3805abdd000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c068796472612d73332e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000004c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000d630aa769278cacde879c5c0fe5d203c000000000000000000000000000000006c617465737400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c02f50ad8aa4ea97859a9a062aa6b8ca58adeed30132d1674c840938651e1d8c1c2a1449bb7bd2f2b325898ec164d562149eee4b41301a0e47b8fdfe81bc4a9fd201ff7f769fe41c476d6fc74ada241b63f2c463e4789e0fc6ee469d60fae271c3128c5f432fce9718f35109a858bf1f0b19c23cc94c5028db14adc661fcc50fe702df8747ce0cd91f4b40d2f675eda4df07fe4633cc72424031f1cfa1f86018a71a399074478034d0396b1660da207e5e465e38257226ccd8884d08de568bc17e149be44bec09645b8849bee14e0db1f9ccbfc61f737633c7f2c0ffc19298c0de1a0cce88ce030df8c1cca51d73eac8071993a576443c2fc071a8c795fc8c51840000000000000000000000000000000000000000000000000000000000000000115e3da4d610e886c1400fc410b73c16e6691a1b7ffa7f2b3bfb1956b322bc121801b584700a740f9576cc7e83745895452edc518a9ce60b430e1272fc4eb93b057cf80de4f8dd3e4c56f948f40c28c3acbeca71ef9f825597bf8cc059f1238b13f534c30cef0c08f68969a071be9d153080dfc99207aa879d0b8d680b593eab15e8b78c4616c5fed846fbd81f52ed63b62a818a56f8cfbb82fb425e8310ee380fda1508ba7662f88f3adae1e4f406d99192befdd41a0ede0579e9fb1a78da640000000000000000000000000000000000000000000000000000000000000002149f70ab0db24a270738aee6f857bec7cb91d3438c8e3dbaf07829b03ffffffc00000000000000000000000000000000000000000000000000000000000000001b31234f626f2f815a2085465332f192349dc35c3afdd798ef78654b9d5a21b502c02b0c8903e5f139b466d5bc5ceda4a647c4c72486e6d61de22fc3805abdd000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c068796472612d73332e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000004c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000e4c011331d91b79639df349a93157a1b000000000000000000000000000000006c617465737400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c0119172f4b3dee8d9ef8ce2e36dc198664b43ef30b4d502e61d707f74109830a500cb489548548310981b3f149c558ab9bfea0708f1a293d419f4a25130c64f0d2098e7a7f4fdc4d248f2983b6397e9b8dc7fd358df639b76a9c8b6e681b8cae823794fa0dad9bd2923dc6159deb5244975681c03894ffd249d9fbf53569d882a1118833e64275f47bc014e1c6a7a95d603b051ef8d4a544d6fc1234a508dc328254971ce57bf94ccec46be9352d50ecd1d4ad2c7be19412eb87db0911849ee3d1c482ab4ea1d9517bb92f8819db96d34a176dcc619d61e9f2f435c6753c922ac059323ef3812665ef93cf1ff513b815762ff0bebe83b2b068123dd7ccad37df30000000000000000000000000000000000000000000000000000000000000000115e3da4d610e886c1400fc410b73c16e6691a1b7ffa7f2b3bfb1956b322bc121801b584700a740f9576cc7e83745895452edc518a9ce60b430e1272fc4eb93b057cf80de4f8dd3e4c56f948f40c28c3acbeca71ef9f825597bf8cc059f1238b13f534c30cef0c08f68969a071be9d153080dfc99207aa879d0b8d680b593eab209a1705dd5ab4d5e527a8f5fd8b91ffcd069e2cac71a8ccd36ce64d432599d607e789b7817d43986c2a7db25718acdcd06c717c171a26a97efcdcd01aecdae60000000000000000000000000000000000000000000000000000000000000001232ed76798cb36ef589e1dc08d1018a6cb91d3438c8e3dbaf07829b03ffffffc00000000000000000000000000000000000000000000000000000000000000001b31234f626f2f815a2085465332f192349dc35c3afdd798ef78654b9d5a21b502c02b0c8903e5f139b466d5bc5ceda4a647c4c72486e6d61de22fc3805abdd000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c068796472612d73332e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000004c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000005629c9a54e30d8c8aea911a48cd9e30000000000000000000000000000000006c617465737400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c02e1f3f02457677065bde725fedb58229502863e1cd0878aba9d3ad1ab6496d1a2e920db982893a66b6018dd5325b9d83d314babc7b3d33d25013ba96617bb4f826b611b1e97352af927768220a84ae483f72ba7b198beccc1d9a81906d979b2c0af323714701bf7706b67a53faf91b04431fc9d1f199240e6f2bbb4b07088ad72579391bf5752a62b8db862275722cf41b950705959fad396c1be22be96eba450fa41bb572fb6663e0da5b6bc043bfcabc48f52176f31c7e7d249bb3c60f81571d21bd7d3c707152b22e4a290b8472fd7d7fe0e248facc6e94936d220e86f74e250e1865f0a6005686b424d903a43a4f2fa7d6b0e91120c7561d3367394c376e0000000000000000000000000000000000000000000000000000000000000000115e3da4d610e886c1400fc410b73c16e6691a1b7ffa7f2b3bfb1956b322bc121801b584700a740f9576cc7e83745895452edc518a9ce60b430e1272fc4eb93b057cf80de4f8dd3e4c56f948f40c28c3acbeca71ef9f825597bf8cc059f1238b13f534c30cef0c08f68969a071be9d153080dfc99207aa879d0b8d680b593eab1d6a7b5926651f32be2016f52cd91d3d5913978f331f13167485dbee8899dfb425b4a8d506b70c2f8c2b551404cf2cccb1da7ff7017d7625df93fced957f8521000000000000000000000000000000000000000000000000000000000000000105629c9a54e30d8c8aea911a48cd9e306c61746573740000000000000000000000000000000000000000000000000000000000000000000000000000000000001b31234f626f2f815a2085465332f192349dc35c3afdd798ef78654b9d5a21b502c02b0c8903e5f139b466d5bc5ceda4a647c4c72486e6d61de22fc3805abdd0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"; 
    
    vm.startPrank(0x061060a65146b3265C62fC8f3AE977c9B27260fF);

    // Call the airdrop contract with your signed address to have a valid signature
    airdrop.claimWithSismo(0x938f169352008d35e065F153be53b3D3C07Bcd90, response);
     assertEq(airdrop.balanceOf(0x938f169352008d35e065F153be53b3D3C07Bcd90), 500 * 10 ** 18);

    // Test that if you call the contract a second time, it reverts
    // Since the user has already claimed the token
    vm.expectRevert(abi.encodeWithSignature("UserNotEligibleForAirdrop()"));
    airdrop.claimWithSismo(0x938f169352008d35e065F153be53b3D3C07Bcd90, response);
  }
}

